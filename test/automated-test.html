<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¤– AI ì–´ì‹œìŠ¤í„´íŠ¸ ìë™í™” í…ŒìŠ¤íŠ¸</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary { background: #3498db; color: white; }
        .btn-success { background: #27ae60; color: white; }
        .btn-warning { background: #f39c12; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .test-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #3498db;
        }
        
        .test-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 8px 0;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .test-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }
        
        .status-pending { background: #6c757d; color: white; }
        .status-running { background: #ffc107; color: #212529; animation: pulse 1s infinite; }
        .status-pass { background: #28a745; color: white; }
        .status-fail { background: #dc3545; color: white; }
        .status-skip { background: #17a2b8; color: white; }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .results-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .summary-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .summary-total { color: #6c757d; }
        .summary-pass { color: #28a745; }
        .summary-fail { color: #dc3545; }
        .summary-running { color: #ffc107; }
        
        .log-container {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .log-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .log-container::-webkit-scrollbar-track {
            background: #2d2d2d;
        }
        
        .log-container::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 4px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ddd;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #27ae60);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .error-details {
            background: #ffe6e6;
            border: 1px solid #ff9999;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
            font-size: 12px;
            color: #d32f2f;
        }
        
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .metric-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– AI ì–´ì‹œìŠ¤í„´íŠ¸ ì¢…í•© ìë™í™” í…ŒìŠ¤íŠ¸</h1>
            <p>ëª¨ë“  ê¸°ëŠ¥ì„ ìë™ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ì—¬ í’ˆì§ˆì„ ë³´ì¥í•©ë‹ˆë‹¤</p>
        </div>
        
        <div class="controls">
            <button class="btn btn-success" onclick="runAllTests()">ğŸš€ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <button class="btn btn-primary" onclick="runUITests()">ğŸ¨ UI í…ŒìŠ¤íŠ¸ë§Œ</button>
            <button class="btn btn-info" onclick="runFunctionTests()">âš™ï¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ë§Œ</button>
            <button class="btn btn-warning" onclick="runPerformanceTests()">âš¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ë§Œ</button>
            <button class="btn btn-danger" onclick="stopTests()">â¹ï¸ í…ŒìŠ¤íŠ¸ ì¤‘ì§€</button>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <div class="results-summary">
            <div class="summary-card">
                <div class="summary-label">ì „ì²´ í…ŒìŠ¤íŠ¸</div>
                <div class="summary-value summary-total" id="totalTests">0</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">í†µê³¼</div>
                <div class="summary-value summary-pass" id="passTests">0</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">ì‹¤íŒ¨</div>
                <div class="summary-value summary-fail" id="failTests">0</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">ì§„í–‰ ì¤‘</div>
                <div class="summary-value summary-running" id="runningTests">0</div>
            </div>
        </div>
        
        <div class="test-grid">
            <div class="test-section">
                <h3>ğŸ¨ UI ìš”ì†Œ í…ŒìŠ¤íŠ¸</h3>
                <div class="test-item">
                    <span>ì–´ì‹œìŠ¤í„´íŠ¸ ì´ˆê¸°í™”</span>
                    <div class="test-status status-pending" id="test-init">â³</div>
                </div>
                <div class="test-item">
                    <span>ìŒì„± ì¸ì‹ ë²„íŠ¼ ì‘ë™</span>
                    <div class="test-status status-pending" id="test-speech-btn">â³</div>
                </div>
                <div class="test-item">
                    <span>ìƒíƒœ í‘œì‹œê¸° ì—…ë°ì´íŠ¸</span>
                    <div class="test-status status-pending" id="test-status">â³</div>
                </div>
                <div class="test-item">
                    <span>ë¡œê·¸ ì¶œë ¥ ê¸°ëŠ¥</span>
                    <div class="test-status status-pending" id="test-logging">â³</div>
                </div>
                <div class="test-item">
                    <span>ë²„íŠ¼ ìƒíƒœ ë³€ê²½</span>
                    <div class="test-status status-pending" id="test-btn-state">â³</div>
                </div>
            </div>
            
            <div class="test-section">
                <h3>âš™ï¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h3>
                <div class="test-item">
                    <span>HyperCLOVA X API ì—°ê²°</span>
                    <div class="test-status status-pending" id="test-hyperclova">â³</div>
                </div>
                <div class="test-item">
                    <span>OpenAI API ì—°ê²°</span>
                    <div class="test-status status-pending" id="test-openai">â³</div>
                </div>
                <div class="test-item">
                    <span>ìŒì„± ëª…ë ¹ ì²˜ë¦¬</span>
                    <div class="test-status status-pending" id="test-voice-cmd">â³</div>
                </div>
                <div class="test-item">
                    <span>AI ìŒì„± ì—ì½” í•„í„°ë§</span>
                    <div class="test-status status-pending" id="test-echo-filter">â³</div>
                </div>
                <div class="test-item">
                    <span>ëª…ë ¹ ì‹¤í–‰ ë¡œì§</span>
                    <div class="test-status status-pending" id="test-cmd-exec">â³</div>
                </div>
            </div>
            
            <div class="test-section">
                <h3>ğŸ†š ì„±ëŠ¥ ë¹„êµ í…ŒìŠ¤íŠ¸</h3>
                <div class="test-item">
                    <span>ì„±ëŠ¥ ë¹„êµ ëª¨ë“œ ì§„ì…</span>
                    <div class="test-status status-pending" id="test-compare-mode">â³</div>
                </div>
                <div class="test-item">
                    <span>ë‘ ëª¨ë¸ ë™ì‹œ ë¶„ì„</span>
                    <div class="test-status status-pending" id="test-dual-analysis">â³</div>
                </div>
                <div class="test-item">
                    <span>í†µê³„ ìˆ˜ì§‘ ë° í‘œì‹œ</span>
                    <div class="test-status status-pending" id="test-stats">â³</div>
                </div>
                <div class="test-item">
                    <span>ìŠ¹ë¶€ ê²°ê³¼ íŒì •</span>
                    <div class="test-status status-pending" id="test-winner">â³</div>
                </div>
                <div class="test-item">
                    <span>ì„±ëŠ¥ ë¹„êµ ë³µì›</span>
                    <div class="test-status status-pending" id="test-restore">â³</div>
                </div>
            </div>
            
            <div class="test-section">
                <h3>âš¡ ì„±ëŠ¥ ë©”íŠ¸ë¦­</h3>
                <div class="performance-metrics">
                    <div class="metric-card">
                        <div class="metric-value" id="avgResponseTime">-</div>
                        <div class="metric-label">í‰ê·  ì‘ë‹µì‹œê°„ (ms)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="successRate">-</div>
                        <div class="metric-label">ì„±ê³µë¥  (%)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="errorRate">-</div>
                        <div class="metric-label">ì˜¤ë¥˜ìœ¨ (%)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="testDuration">-</div>
                        <div class="metric-label">í…ŒìŠ¤íŠ¸ ì†Œìš”ì‹œê°„ (s)</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="log-container" id="testLog">
            [ìë™í™” í…ŒìŠ¤íŠ¸ ë¡œê·¸]<br>
            ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ. í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ë ¤ë©´ ìœ„ì˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.<br>
        </div>
    </div>

    <script src="http://localhost:8080/src/standalone/ai-assistant-standalone.js"></script>
    <script>
        class AutomatedTester {
            constructor() {
                this.tests = [];
                this.results = { total: 0, pass: 0, fail: 0, running: 0 };
                this.startTime = 0;
                this.assistant = null;
                this.metrics = {
                    responseTimes: [],
                    errors: [],
                    successes: 0
                };
                
                // í…ŒìŠ¤íŠ¸ ì •ì˜
                this.defineTests();
            }
            
            defineTests() {
                // UI í…ŒìŠ¤íŠ¸
                this.addTest('UI', 'test-init', 'ì–´ì‹œìŠ¤í„´íŠ¸ ì´ˆê¸°í™”', this.testInitialization);
                this.addTest('UI', 'test-speech-btn', 'ìŒì„± ì¸ì‹ ë²„íŠ¼', this.testSpeechButton);
                this.addTest('UI', 'test-status', 'ìƒíƒœ í‘œì‹œê¸°', this.testStatusIndicators);
                this.addTest('UI', 'test-logging', 'ë¡œê·¸ ì¶œë ¥', this.testLogging);
                this.addTest('UI', 'test-btn-state', 'ë²„íŠ¼ ìƒíƒœ', this.testButtonStates);
                
                // ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
                this.addTest('Function', 'test-hyperclova', 'HyperCLOVA X API', this.testHyperCLOVAX);
                this.addTest('Function', 'test-openai', 'OpenAI API', this.testOpenAI);
                this.addTest('Function', 'test-voice-cmd', 'ìŒì„± ëª…ë ¹ ì²˜ë¦¬', this.testVoiceCommand);
                this.addTest('Function', 'test-echo-filter', 'AI ìŒì„± í•„í„°ë§', this.testEchoFilter);
                this.addTest('Function', 'test-cmd-exec', 'ëª…ë ¹ ì‹¤í–‰', this.testCommandExecution);
                
                // ì„±ëŠ¥ ë¹„êµ í…ŒìŠ¤íŠ¸
                this.addTest('Performance', 'test-compare-mode', 'ì„±ëŠ¥ ë¹„êµ ëª¨ë“œ', this.testCompareMode);
                this.addTest('Performance', 'test-dual-analysis', 'ë‘ ëª¨ë¸ ë™ì‹œ ë¶„ì„', this.testDualAnalysis);
                this.addTest('Performance', 'test-stats', 'í†µê³„ ìˆ˜ì§‘', this.testStatistics);
                this.addTest('Performance', 'test-winner', 'ìŠ¹ë¶€ íŒì •', this.testWinnerSelection);
                this.addTest('Performance', 'test-restore', 'ëª¨ë“œ ë³µì›', this.testModeRestore);
            }
            
            addTest(category, id, name, testFunction) {
                this.tests.push({
                    category,
                    id,
                    name,
                    testFunction: testFunction.bind(this),
                    status: 'pending'
                });
                this.results.total++;
            }
            
            async runAllTests() {
                this.log('ğŸš€ ì „ì²´ ìë™í™” í…ŒìŠ¤íŠ¸ ì‹œì‘');
                this.startTime = Date.now();
                
                await this.runTestsByCategory(['UI', 'Function', 'Performance']);
                
                this.generateTestReport();
            }
            
            async runUITests() {
                this.log('ğŸ¨ UI í…ŒìŠ¤íŠ¸ ì‹œì‘');
                await this.runTestsByCategory(['UI']);
            }
            
            async runFunctionTests() {
                this.log('âš™ï¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œì‘');
                await this.runTestsByCategory(['Function']);
            }
            
            async runPerformanceTests() {
                this.log('âš¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œì‘');
                await this.runTestsByCategory(['Performance']);
            }
            
            async runTestsByCategory(categories) {
                // Function ë˜ëŠ” Performance í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œ ì–´ì‹œìŠ¤í„´íŠ¸ ì´ˆê¸°í™” í•„ìš”
                if (!this.assistant && categories.some(cat => cat === 'Function' || cat === 'Performance')) {
                    this.log('\nğŸ”§ ì–´ì‹œìŠ¤í„´íŠ¸ ì´ˆê¸°í™” ì¤‘...');
                    const initTest = this.tests.find(test => test.id === 'test-init');
                    if (initTest) {
                        await this.runSingleTest(initTest);
                    }
                }
                
                const testsToRun = this.tests.filter(test => categories.includes(test.category));
                
                for (let i = 0; i < testsToRun.length; i++) {
                    const test = testsToRun[i];
                    await this.runSingleTest(test);
                    this.updateProgress(i + 1, testsToRun.length);
                }
            }
            
            async runSingleTest(test) {
                this.log(`ğŸ”§ [${test.category}] ${test.name} í…ŒìŠ¤íŠ¸ ì‹œì‘...`);
                
                // ìƒíƒœ ì—…ë°ì´íŠ¸
                this.setTestStatus(test.id, 'running');
                this.results.running++;
                this.updateSummary();
                
                const startTime = performance.now();
                
                try {
                    const result = await test.testFunction();
                    const responseTime = performance.now() - startTime;
                    
                    // ìŠ¤í‚µëœ í…ŒìŠ¤íŠ¸ ì²˜ë¦¬
                    if (result && result.skipped) {
                        this.setTestStatus(test.id, 'skip');
                        this.results.running--;
                        this.log(`â­ï¸ [${test.category}] ${test.name} ìŠ¤í‚µ: ${result.reason}`);
                        return;
                    }
                    
                    this.metrics.responseTimes.push(responseTime);
                    this.metrics.successes++;
                    
                    this.setTestStatus(test.id, 'pass');
                    this.results.pass++;
                    this.results.running--;
                    
                    this.log(`âœ… [${test.category}] ${test.name} í†µê³¼ (${responseTime.toFixed(0)}ms)`);
                    
                } catch (error) {
                    const responseTime = performance.now() - startTime;
                    this.metrics.errors.push({ test: test.name, error: error.message, time: responseTime });
                    
                    this.setTestStatus(test.id, 'fail');
                    this.results.fail++;
                    this.results.running--;
                    
                    this.log(`âŒ [${test.category}] ${test.name} ì‹¤íŒ¨: ${error.message}`);
                    
                    // ì˜¤ë¥˜ ìƒì„¸ ì •ë³´ í‘œì‹œ
                    this.showErrorDetails(test.id, error);
                }
                
                this.updateSummary();
                await this.delay(500); // í…ŒìŠ¤íŠ¸ ê°„ ê°„ê²©
            }
            
            // ===== ê°œë³„ í…ŒìŠ¤íŠ¸ êµ¬í˜„ =====
            
            async testInitialization() {
                // AI ì–´ì‹œìŠ¤í„´íŠ¸ ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸ - API í‚¤ëŠ” ì‹¤ì œ í™˜ê²½ì—ì„œ ì„¤ì • í•„ìš”
                const hyperclovaKey = process.env.HYPERCLOVA_API_KEY || 'YOUR_HYPERCLOVA_API_KEY';
                const openaiKey = process.env.OPENAI_API_KEY || 'YOUR_OPENAI_API_KEY';
                
                this.assistant = new AIAssistantStandalone({
                    hyperclovaApiKey: hyperclovaKey,
                    openaiApiKey: openaiKey,
                    useAIIntent: true,
                    enableLogging: false, // í…ŒìŠ¤íŠ¸ ì¤‘ì—ëŠ” ë¡œê¹… ë¹„í™œì„±í™”
                    autoStart: false
                });
                
                if (!this.assistant) {
                    throw new Error('ì–´ì‹œìŠ¤í„´íŠ¸ ê°ì²´ ìƒì„± ì‹¤íŒ¨');
                }
                
                if (!this.assistant.config.hyperclovaApiKey) {
                    throw new Error('HyperCLOVA X API í‚¤ ì„¤ì • ì‹¤íŒ¨');
                }
                
                return true;
            }
            
            async testSpeechButton() {
                if (!this.assistant) {
                    throw new Error('ì–´ì‹œìŠ¤í„´íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ');
                }
                
                // ìŒì„± ì¸ì‹ ì‹œì‘/ì¤‘ì§€ í…ŒìŠ¤íŠ¸
                this.assistant.startListening();
                await this.delay(1000);
                
                if (!this.assistant.isListening) {
                    throw new Error('ìŒì„± ì¸ì‹ ì‹œì‘ ì‹¤íŒ¨');
                }
                
                this.assistant.stopListening();
                await this.delay(500);
                
                if (this.assistant.isListening) {
                    throw new Error('ìŒì„± ì¸ì‹ ì¤‘ì§€ ì‹¤íŒ¨');
                }
                
                return true;
            }
            
            async testStatusIndicators() {
                // ìƒíƒœ í‘œì‹œê¸° ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸
                const statusElements = ['hyperclovaStatus', 'speechStatus', 'aiEngineStatus'];
                
                for (const elementId of statusElements) {
                    const element = document.getElementById(elementId);
                    if (element) {
                        // ì„ì‹œë¡œ ìƒíƒœ ë³€ê²½í•´ë³´ê¸°
                        const originalText = element.textContent;
                        element.textContent = 'í…ŒìŠ¤íŠ¸ ì¤‘';
                        await this.delay(100);
                        element.textContent = originalText;
                    }
                }
                
                return true;
            }
            
            async testLogging() {
                // ë¡œê·¸ ì¶œë ¥ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ - ë¡œê·¸ ì˜ì—­ì— ë©”ì‹œì§€ê°€ ì‹¤ì œë¡œ ì¶”ê°€ë˜ëŠ”ì§€ í™•ì¸
                const logArea = document.querySelector('.log-area') || document.getElementById('logArea');
                
                if (!logArea) {
                    this.log('âš ï¸ ë¡œê·¸ ì˜ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ - ì½˜ì†” ë¡œê·¸ í…ŒìŠ¤íŠ¸ë¡œ ëŒ€ì²´');
                    
                    // ì½˜ì†” ë¡œê·¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
                    const originalLog = console.log;
                    let logCaptured = false;
                    
                    console.log = (...args) => {
                        logCaptured = true;
                        originalLog(...args);
                    };
                    
                    this.log('ğŸ”§ í…ŒìŠ¤íŠ¸ ë¡œê·¸ ë©”ì‹œì§€');
                    console.log = originalLog;
                    
                    return logCaptured;
                }
                
                const initialLogCount = logArea.children.length;
                
                // ë¡œê·¸ ë©”ì‹œì§€ ì¶”ê°€
                this.log('ğŸ”§ í…ŒìŠ¤íŠ¸ ë¡œê·¸ ë©”ì‹œì§€');
                
                // ì ì‹œ ëŒ€ê¸° í›„ ë¡œê·¸ê°€ ì¶”ê°€ë˜ì—ˆëŠ”ì§€ í™•ì¸
                await new Promise(resolve => setTimeout(resolve, 100));
                
                const finalLogCount = logArea.children.length;
                
                return finalLogCount > initialLogCount;
            }
            
            async testButtonStates() {
                // ë²„íŠ¼ ìƒíƒœ ë³€ê²½ í…ŒìŠ¤íŠ¸ (ì‹œë®¬ë ˆì´ì…˜)
                const testButton = document.createElement('button');
                testButton.disabled = false;
                
                testButton.disabled = true;
                if (!testButton.disabled) {
                    throw new Error('ë²„íŠ¼ ë¹„í™œì„±í™” ì‹¤íŒ¨');
                }
                
                testButton.disabled = false;
                if (testButton.disabled) {
                    throw new Error('ë²„íŠ¼ í™œì„±í™” ì‹¤íŒ¨');
                }
                
                return true;
            }
            
            async testHyperCLOVAX() {
                if (!this.assistant) {
                    throw new Error('ì–´ì‹œìŠ¤í„´íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ');
                }
                
                try {
                    const result = await this.assistant.callHyperCLOVAX('ë¡œê·¸ì¸');
                    
                    if (!result || !result.intent) {
                        throw new Error('HyperCLOVA X ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜');
                    }
                    
                    if (typeof result.confidence !== 'number') {
                        throw new Error('ì‹ ë¢°ë„ ê°’ì´ ìˆ«ìê°€ ì•„ë‹˜');
                    }
                    
                    return true;
                } catch (error) {
                    throw new Error(`HyperCLOVA X API í˜¸ì¶œ ì‹¤íŒ¨: ${error.message}`);
                }
            }
            
            async testOpenAI() {
                if (!this.assistant || !this.assistant.config.openaiApiKey) {
                    this.log('â­ï¸ OpenAI API í‚¤ ë¯¸ì„¤ì • - í…ŒìŠ¤íŠ¸ ìŠ¤í‚µ');
                    return { skipped: true, reason: 'OpenAI API í‚¤ ë¯¸ì„¤ì •' };
                }
                
                try {
                    const result = await this.assistant.callOpenAI('ë¡œê·¸ì¸');
                    
                    if (!result || !result.intent) {
                        throw new Error('OpenAI ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜');
                    }
                    
                    return true;
                } catch (error) {
                    throw new Error(`OpenAI API í˜¸ì¶œ ì‹¤íŒ¨: ${error.message}`);
                }
            }
            
            async testVoiceCommand() {
                if (!this.assistant) {
                    throw new Error('ì–´ì‹œìŠ¤í„´íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ');
                }
                
                // ìŒì„± ëª…ë ¹ ì²˜ë¦¬ ì‹œë®¬ë ˆì´ì…˜
                try {
                    const testTranscript = 'ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”';
                    await this.assistant.processCommand(testTranscript);
                    return true;
                } catch (error) {
                    throw new Error(`ìŒì„± ëª…ë ¹ ì²˜ë¦¬ ì‹¤íŒ¨: ${error.message}`);
                }
            }
            
            async testEchoFilter() {
                if (!this.assistant) {
                    throw new Error('ì–´ì‹œìŠ¤í„´íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ');
                }
                
                // AI ìŒì„± ì—ì½” í•„í„°ë§ í…ŒìŠ¤íŠ¸
                this.assistant.markAISpeechActive('ë¡œê·¸ì¸ì„ ì§„í–‰í•©ë‹ˆë‹¤');
                const isEcho = this.assistant.isAISpeechEcho('ë¡œê·¸ì¸ì„ ì§„í–‰í•©ë‹ˆë‹¤');
                
                if (!isEcho) {
                    throw new Error('AI ìŒì„± ì—ì½” ê°ì§€ ì‹¤íŒ¨');
                }
                
                this.assistant.markAISpeechComplete();
                const isNoEcho = this.assistant.isAISpeechEcho('ê²€ìƒ‰í•´ì£¼ì„¸ìš”');
                
                if (isNoEcho) {
                    throw new Error('ì¼ë°˜ ìŒì„±ì„ ì—ì½”ë¡œ ì˜ëª» ê°ì§€');
                }
                
                return true;
            }
            
            async testCommandExecution() {
                if (!this.assistant) {
                    throw new Error('ì–´ì‹œìŠ¤í„´íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ');
                }
                
                // ëª…ë ¹ ì‹¤í–‰ ë¡œì§ í…ŒìŠ¤íŠ¸
                const mockIntent = {
                    intent: 'click',
                    confidence: 0.9,
                    target: 'test',
                    source: 'test'
                };
                
                try {
                    await this.assistant.executeIntentAction(mockIntent);
                    return true;
                } catch (error) {
                    throw new Error(`ëª…ë ¹ ì‹¤í–‰ ì‹¤íŒ¨: ${error.message}`);
                }
            }
            
            async testCompareMode() {
                // ì„±ëŠ¥ ë¹„êµ ëª¨ë“œ ì§„ì… í…ŒìŠ¤íŠ¸
                if (!this.assistant) {
                    throw new Error('ì–´ì‹œìŠ¤í„´íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ');
                }
                
                // ì›ë˜ processCommand ë°±ì—…
                const originalProcessCommand = this.assistant.processCommand.bind(this.assistant);
                
                // ì„±ëŠ¥ ë¹„êµ ëª¨ë“œë¡œ ì „í™˜ (ì‹œë®¬ë ˆì´ì…˜)
                let comparisonModeActive = false;
                this.assistant.processCommand = async (transcript) => {
                    comparisonModeActive = true;
                    return originalProcessCommand(transcript);
                };
                
                // í…ŒìŠ¤íŠ¸ ì‹¤í–‰
                await this.assistant.processCommand('í…ŒìŠ¤íŠ¸');
                
                if (!comparisonModeActive) {
                    throw new Error('ì„±ëŠ¥ ë¹„êµ ëª¨ë“œ ì§„ì… ì‹¤íŒ¨');
                }
                
                // ë³µì›
                this.assistant.processCommand = originalProcessCommand;
                
                return true;
            }
            
            async testDualAnalysis() {
                // ë‘ ëª¨ë¸ ë™ì‹œ ë¶„ì„ í…ŒìŠ¤íŠ¸
                if (!this.assistant) {
                    throw new Error('ì–´ì‹œìŠ¤í„´íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ');
                }
                
                const transcript = 'ë¡œê·¸ì¸';
                const startTime = performance.now();
                
                const promises = [];
                
                // HyperCLOVA X
                if (this.assistant.config.hyperclovaApiKey) {
                    promises.push(this.assistant.callHyperCLOVAX(transcript));
                }
                
                // OpenAI
                if (this.assistant.config.openaiApiKey) {
                    promises.push(this.assistant.callOpenAI(transcript));
                }
                
                if (promises.length === 0) {
                    return { skipped: true, reason: 'API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ' };
                }
                
                if (promises.length < 2) {
                    this.log('â­ï¸ ë‘ ëª¨ë¸ ë¹„êµë¥¼ ìœ„í•´ì„œëŠ” ë‘ API í‚¤ê°€ ëª¨ë‘ í•„ìš” - í…ŒìŠ¤íŠ¸ ìŠ¤í‚µ');
                    return { skipped: true, reason: 'ë‘ ëª¨ë¸ ë¹„êµë¥¼ ìœ„í•´ì„œëŠ” ë‘ API í‚¤ê°€ ëª¨ë‘ í•„ìš”' };
                }
                
                try {
                    const results = await Promise.all(promises);
                    
                    if (results.length === 0) {
                        throw new Error('ê²°ê³¼ê°€ ì—†ìŒ');
                    }
                    
                    const responseTime = performance.now() - startTime;
                    this.log(`ë‘ ëª¨ë¸ ë™ì‹œ ë¶„ì„ ì™„ë£Œ: ${responseTime.toFixed(0)}ms`);
                    
                    return true;
                } catch (error) {
                    throw new Error(`ë™ì‹œ ë¶„ì„ ì‹¤íŒ¨: ${error.message}`);
                }
            }
            
            async testStatistics() {
                // í†µê³„ ìˆ˜ì§‘ í…ŒìŠ¤íŠ¸
                const mockStats = {
                    hyperclova: { tests: 5, totalTime: 4500, successes: 4 },
                    openai: { tests: 5, totalTime: 6000, successes: 5 }
                };
                
                // í‰ê·  ì‘ë‹µì‹œê°„ ê³„ì‚°
                const hcxAvg = mockStats.hyperclova.totalTime / mockStats.hyperclova.tests;
                const oaiAvg = mockStats.openai.totalTime / mockStats.openai.tests;
                
                if (hcxAvg <= 0 || oaiAvg <= 0) {
                    throw new Error('í†µê³„ ê³„ì‚° ì˜¤ë¥˜');
                }
                
                return true;
            }
            
            async testWinnerSelection() {
                // ìŠ¹ë¶€ íŒì • í…ŒìŠ¤íŠ¸
                const results = {
                    hyperclova: { confidence: 0.9, responseTime: 800, source: 'hyperclova-x-v3' },
                    openai: { confidence: 0.8, responseTime: 1200, source: 'openai' }
                };
                
                // ìŠ¹ë¶€ íŒì • ë¡œì§ (HyperCLOVA Xê°€ ì´ê¸¸ ê²ƒìœ¼ë¡œ ì˜ˆìƒ)
                const hcxScore = results.hyperclova.confidence + 0.1; // í•œêµ­ì–´ ê°€ì 
                const openaiScore = results.openai.confidence;
                
                const winner = hcxScore >= openaiScore ? results.hyperclova : results.openai;
                
                if (!winner) {
                    throw new Error('ìŠ¹ë¶€ íŒì • ì‹¤íŒ¨');
                }
                
                return true;
            }
            
            async testModeRestore() {
                // ëª¨ë“œ ë³µì› í…ŒìŠ¤íŠ¸
                if (!this.assistant) {
                    throw new Error('ì–´ì‹œìŠ¤í„´íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ');
                }
                
                const originalProcessCommand = this.assistant.processCommand;
                
                // ì„ì‹œë¡œ ë‹¤ë¥¸ í•¨ìˆ˜ë¡œ êµì²´
                this.assistant.processCommand = async () => { return 'test'; };
                
                await this.delay(100);
                
                // ë³µì›
                this.assistant.processCommand = originalProcessCommand;
                
                if (this.assistant.processCommand === originalProcessCommand) {
                    return true;
                } else {
                    throw new Error('ëª¨ë“œ ë³µì› ì‹¤íŒ¨');
                }
            }
            
            // ===== ìœ í‹¸ë¦¬í‹° ë©”ì„œë“œ =====
            
            setTestStatus(testId, status) {
                const element = document.getElementById(testId);
                if (element) {
                    element.className = `test-status status-${status}`;
                    
                    switch (status) {
                        case 'running':
                            element.textContent = 'ğŸ”„';
                            break;
                        case 'pass':
                            element.textContent = 'âœ…';
                            break;
                        case 'fail':
                            element.textContent = 'âŒ';
                            break;
                        case 'skip':
                            element.textContent = 'â­ï¸';
                            break;
                        default:
                            element.textContent = 'â³';
                    }
                }
            }
            
            showErrorDetails(testId, error) {
                const testElement = document.getElementById(testId).closest('.test-item');
                
                // ê¸°ì¡´ ì˜¤ë¥˜ ìƒì„¸ ì •ë³´ ì œê±°
                const existingError = testElement.querySelector('.error-details');
                if (existingError) {
                    existingError.remove();
                }
                
                // ìƒˆë¡œìš´ ì˜¤ë¥˜ ìƒì„¸ ì •ë³´ ì¶”ê°€
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-details';
                errorDiv.textContent = error.message;
                
                testElement.appendChild(errorDiv);
            }
            
            updateProgress(current, total) {
                const percentage = (current / total) * 100;
                document.getElementById('progressFill').style.width = `${percentage}%`;
            }
            
            updateSummary() {
                document.getElementById('totalTests').textContent = this.results.total;
                document.getElementById('passTests').textContent = this.results.pass;
                document.getElementById('failTests').textContent = this.results.fail;
                document.getElementById('runningTests').textContent = this.results.running;
                
                // ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
                if (this.metrics.responseTimes.length > 0) {
                    const avgTime = this.metrics.responseTimes.reduce((a, b) => a + b, 0) / this.metrics.responseTimes.length;
                    document.getElementById('avgResponseTime').textContent = avgTime.toFixed(0);
                }
                
                const totalTests = this.results.pass + this.results.fail;
                if (totalTests > 0) {
                    const successRate = (this.results.pass / totalTests) * 100;
                    const errorRate = (this.results.fail / totalTests) * 100;
                    
                    document.getElementById('successRate').textContent = successRate.toFixed(1);
                    document.getElementById('errorRate').textContent = errorRate.toFixed(1);
                }
            }
            
            generateTestReport() {
                const duration = (Date.now() - this.startTime) / 1000;
                document.getElementById('testDuration').textContent = duration.toFixed(1);
                
                this.log('');
                this.log('ğŸ“Š ===== í…ŒìŠ¤íŠ¸ ì™„ë£Œ ë³´ê³ ì„œ =====');
                this.log(`â±ï¸  ì´ ì†Œìš”ì‹œê°„: ${duration.toFixed(1)}ì´ˆ`);
                this.log(`âœ… í†µê³¼: ${this.results.pass}/${this.results.total}`);
                this.log(`âŒ ì‹¤íŒ¨: ${this.results.fail}/${this.results.total}`);
                this.log(`ğŸ“ˆ ì„±ê³µë¥ : ${((this.results.pass / this.results.total) * 100).toFixed(1)}%`);
                
                if (this.metrics.responseTimes.length > 0) {
                    const avgTime = this.metrics.responseTimes.reduce((a, b) => a + b, 0) / this.metrics.responseTimes.length;
                    this.log(`âš¡ í‰ê·  ì‘ë‹µì‹œê°„: ${avgTime.toFixed(0)}ms`);
                }
                
                if (this.metrics.errors.length > 0) {
                    this.log('');
                    this.log('ğŸ› ë°œê²¬ëœ ì˜¤ë¥˜:');
                    this.metrics.errors.forEach(error => {
                        this.log(`  - ${error.test}: ${error.error}`);
                    });
                }
                
                this.log('');
                this.log('ğŸ‰ ìë™í™” í…ŒìŠ¤íŠ¸ ì™„ë£Œ!');
                
                // ì„±ê³µë¥ ì— ë”°ë¥¸ ê²°ê³¼ ë©”ì‹œì§€
                const successRate = (this.results.pass / this.results.total) * 100;
                if (successRate === 100) {
                    this.log('ğŸ† ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼! ì™„ë²½í•œ í’ˆì§ˆì…ë‹ˆë‹¤.');
                } else if (successRate >= 90) {
                    this.log('ğŸ‘ ëŒ€ë¶€ë¶„ì˜ í…ŒìŠ¤íŠ¸ í†µê³¼! ë†’ì€ í’ˆì§ˆì…ë‹ˆë‹¤.');
                } else if (successRate >= 70) {
                    this.log('âš ï¸ ì¼ë¶€ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨. ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                } else {
                    this.log('ğŸš¨ ë‹¤ìˆ˜ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨. ì¦‰ì‹œ ìˆ˜ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                }
            }
            
            log(message) {
                const logContainer = document.getElementById('testLog');
                const timestamp = new Date().toLocaleTimeString('ko-KR');
                logContainer.innerHTML += `[${timestamp}] ${message}<br>`;
                logContainer.scrollTop = logContainer.scrollHeight;
            }
            
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            stopTests() {
                this.log('ğŸ›‘ í…ŒìŠ¤íŠ¸ ì¤‘ì§€ë¨');
                // ì‹¤ì œë¡œëŠ” Promise ì²´ì¸ì„ ì¤‘ë‹¨í•˜ê¸° ì–´ë ¤ìš°ë¯€ë¡œ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                alert('í…ŒìŠ¤íŠ¸ê°€ ì¤‘ì§€ë©ë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ì´ˆê¸°í™”í•˜ì„¸ìš”.');
            }
        }
        
        // ì „ì—­ í…ŒìŠ¤í„° ì¸ìŠ¤í„´ìŠ¤
        let tester;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            tester = new AutomatedTester();
            tester.log('ğŸ¤– ìë™í™” í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ');
        });
        
        // ì „ì—­ í•¨ìˆ˜ë“¤
        function runAllTests() {
            tester.runAllTests();
        }
        
        function runUITests() {
            tester.runUITests();
        }
        
        function runFunctionTests() {
            tester.runFunctionTests();
        }
        
        function runPerformanceTests() {
            tester.runPerformanceTests();
        }
        
        function stopTests() {
            tester.stopTests();
        }
    </script>
</body>
</html>