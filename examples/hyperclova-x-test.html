<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HyperCLOVA X í…ŒìŠ¤íŠ¸ - AI ì–´ì‹œìŠ¤í„´íŠ¸</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .api-setup {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #3498db;
        }
        
        .api-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 14px;
            margin: 10px 0;
            font-family: monospace;
        }
        
        .api-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .status-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.2s ease;
        }
        
        .status-card:hover {
            transform: translateY(-5px);
        }
        
        .status-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .status-active { color: #27ae60; }
        .status-inactive { color: #e74c3c; }
        .status-processing { color: #f39c12; }
        
        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }
        
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: none;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(45deg, #27ae60, #229954);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .log-container {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .comparison-section {
            margin-top: 40px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .engine-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #3498db;
        }
        
        .engine-card.hyperclova {
            border-left-color: #00c851;
        }
        
        .engine-card.openai {
            border-left-color: #ff4444;
        }
        
        .test-commands {
            margin: 20px 0;
            padding: 15px;
            background: #e8f5e8;
            border-radius: 8px;
            border-left: 4px solid #27ae60;
        }
        
        .command-item {
            margin: 8px 0;
            padding: 8px 12px;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        
        .command-item:hover {
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– HyperCLOVA X í…ŒìŠ¤íŠ¸</h1>
        <p class="subtitle">ì‹œë‹ˆì–´ ì¹œí™”í˜• AI ì–´ì‹œìŠ¤í„´íŠ¸ - í•œêµ­ ë¬¸í™” íŠ¹í™” ë²„ì „</p>
        
        <div class="api-setup">
            <h3>ğŸ”‘ API ì„¤ì •</h3>
            <p>âœ… HyperCLOVA X API í‚¤: ìë™ ì„¤ì •ë¨</p>
            <p>âœ… OpenAI API í‚¤: í´ë°±ìš© ìë™ ì„¤ì •ë¨</p>
            <p>ğŸš€ ì–´ì‹œìŠ¤í„´íŠ¸ ìë™ ì´ˆê¸°í™” ì¤‘...</p>
            <p>âš ï¸ <strong>CORS ì´ìŠˆ</strong>: Chromeì„ <code>--disable-web-security --user-data-dir=/tmp/chrome</code> í”Œë˜ê·¸ë¡œ ì‹¤í–‰í•´ì•¼ API í˜¸ì¶œ ê°€ëŠ¥</p>
        </div>
        
        <div class="status-grid">
            <div class="status-card">
                <div class="status-label">HyperCLOVA X ìƒíƒœ</div>
                <div id="hyperclovaStatus" class="status-value status-inactive">ëŒ€ê¸°</div>
            </div>
            <div class="status-card">
                <div class="status-label">ìŒì„± ì¸ì‹ ìƒíƒœ</div>
                <div id="speechStatus" class="status-value status-inactive">ì¤‘ì§€</div>
            </div>
            <div class="status-card">
                <div class="status-label">AI ì—”ì§„</div>
                <div id="aiEngineStatus" class="status-value status-inactive">ë¯¸ì„¤ì •</div>
            </div>
            <div class="status-card">
                <div class="status-label">ì‘ë‹µ ì‹œê°„</div>
                <div id="responseTime" class="status-value">0ms</div>
            </div>
        </div>
        
        <div class="control-panel">
            <button id="startBtn" onclick="startListening()" class="btn btn-success">ğŸ¤ ìŒì„± ì¸ì‹ ì‹œì‘</button>
            <button id="stopBtn" onclick="stopListening()" class="btn btn-danger" disabled>â¹ï¸ ì¸ì‹ ì¤‘ì§€</button>
            <button onclick="clearLogs()" class="btn btn-warning">ğŸ—‘ï¸ ë¡œê·¸ ì§€ìš°ê¸°</button>
            <button onclick="testHyperCLOVA()" class="btn btn-primary">ğŸ§ª HyperCLOVA í…ŒìŠ¤íŠ¸</button>
            <button onclick="compareEngines()" class="btn btn-info">ğŸ†š ì„±ëŠ¥ ë¹„êµ</button>
        </div>
        
        <div class="test-commands">
            <h4>ğŸ“ í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´ (í´ë¦­í•´ì„œ ìŒì„± ì‹œë®¬ë ˆì´ì…˜)</h4>
            <div class="command-item" onclick="simulateVoice('ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”')">ğŸ”‘ "ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”"</div>
            <div class="command-item" onclick="simulateVoice('ê²€ìƒ‰í•˜ê³  ì‹¶ì–´ìš”')">ğŸ” "ê²€ìƒ‰í•˜ê³  ì‹¶ì–´ìš”"</div>
            <div class="command-item" onclick="simulateVoice('ë©”ë‰´ ì¢€ ì—´ì–´ì¤˜')">ğŸ“‹ "ë©”ë‰´ ì¢€ ì—´ì–´ì¤˜"</div>
            <div class="command-item" onclick="simulateVoice('ìœ„ë¡œ ì˜¬ë ¤ì£¼ì„¸ìš”')">â¬†ï¸ "ìœ„ë¡œ ì˜¬ë ¤ì£¼ì„¸ìš”"</div>
            <div class="command-item" onclick="simulateVoice('ê·¸ê²Œ ë§ë‚˜ìš”')">â“ "ê·¸ê²Œ ë§ë‚˜ìš”" (ì˜ì‹¬ í‘œí˜„)</div>
            <div class="command-item" onclick="simulateVoice('ë§¥ë‚  ì°¾ì•„ì¤˜')">ğŸ” "ë§¥ë‚  ì°¾ì•„ì¤˜" (ë¸Œëœë“œëª…)</div>
        </div>
        
        <div class="comparison-section">
            <h3>âš¡ ì„±ëŠ¥ ë¹„êµ (HyperCLOVA X vs OpenAI)</h3>
            <div class="comparison-grid">
                <div class="engine-card hyperclova">
                    <h4>ğŸ‡°ğŸ‡· HyperCLOVA X</h4>
                    <div>ì •í™•ë„: <span id="hyperclovaAccuracy">ì¸¡ì • ì¤‘...</span></div>
                    <div>í‰ê·  ì‘ë‹µì‹œê°„: <span id="hyperclovaSpeed">-</span></div>
                    <div>ë¬¸í™”ì  ì´í•´ë„: <span id="hyperclovalCulture">-</span></div>
                    <div>í…ŒìŠ¤íŠ¸ íšŸìˆ˜: <span id="hyperclovaTests">0</span></div>
                </div>
                <div class="engine-card openai">
                    <h4>ğŸŒ OpenAI GPT-4o</h4>
                    <div>ì •í™•ë„: <span id="openaiAccuracy">ì¸¡ì • ì¤‘...</span></div>
                    <div>í‰ê·  ì‘ë‹µì‹œê°„: <span id="openaiSpeed">-</span></div>
                    <div>ë¬¸í™”ì  ì´í•´ë„: <span id="openaiCulture">-</span></div>
                    <div>í…ŒìŠ¤íŠ¸ íšŸìˆ˜: <span id="openaiTests">0</span></div>
                </div>
            </div>
        </div>
        
        <div class="log-container" id="logContainer">
            <div>ğŸš€ HyperCLOVA X í…ŒìŠ¤íŠ¸ ì‹œì‘...</div>
        </div>
    </div>

    <script src="http://localhost:8080/src/standalone/ai-assistant-standalone.js" onload="console.log('âœ… ai-assistant-standalone.js ë¡œë“œë¨')" onerror="console.error('âŒ ai-assistant-standalone.js ë¡œë“œ ì‹¤íŒ¨')"></script>
    <script>
        // ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ í™•ì¸ ë° ì¦‰ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(async () => {
                if (typeof AIAssistantStandalone !== 'undefined') {
                    console.log('âœ… ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ í™•ì¸ë¨');
                    await autoInitialize();
                } else {
                    console.error('âŒ AIAssistantStandalone í´ë˜ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
            }, 100);
        });
        
        async function autoInitialize() {
            log('ğŸ“± HyperCLOVA X í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œë¨');
            log('ğŸš€ ìë™ ì´ˆê¸°í™” ì‹œì‘...');
            await initializeAssistant();
        }
        let assistant = null;
        let testResults = {
            hyperclova: { tests: 0, totalTime: 0, successes: 0, culturalScores: [] },
            openai: { tests: 0, totalTime: 0, successes: 0, culturalScores: [] }
        };
        
        function log(message) {
            const logContainer = document.getElementById('logContainer');
            const now = new Date().toLocaleTimeString('ko-KR');
            logContainer.innerHTML += `<div>[${now}] ${message}</div>`;
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '<div>ğŸ—‘ï¸ ë¡œê·¸ ì§€ì›Œì§</div>';
        }
        
        function updateStatus(elementId, value, className) {
            const element = document.getElementById(elementId);
            element.textContent = value;
            element.className = `status-value ${className}`;
        }
        
        async function initializeAssistant() {
            // API í‚¤ëŠ” í™˜ê²½ë³€ìˆ˜ë‚˜ ì‚¬ìš©ì ì…ë ¥ì—ì„œ ê°€ì ¸ì˜¤ê¸°
            const hyperclovaKey = prompt('HyperCLOVA X API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”:') || 'YOUR_HYPERCLOVA_API_KEY';
            const openaiKey = prompt('OpenAI API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­):') || 'YOUR_OPENAI_API_KEY';
            
            log('ğŸš€ AI ì–´ì‹œìŠ¤í„´íŠ¸ ì´ˆê¸°í™” ì¤‘...');
            console.log('AIAssistantStandalone í´ë˜ìŠ¤:', typeof AIAssistantStandalone);
            
            assistant = new AIAssistantStandalone({
                hyperclovaApiKey: hyperclovaKey, // v3 API í˜•ì‹ìœ¼ë¡œ ìˆ˜ì • ì™„ë£Œ
                openaiApiKey: openaiKey, // OpenAI í´ë°± ìš°ì„  ì‚¬ìš©
                useAIIntent: true,
                enableLogging: true,
                autoStart: false  // ìë™ ì‹œì‘ ë¹„í™œì„±í™”
            });
            
            // ê°•ì œë¡œ ìŒì„± ì¸ì‹ ìƒíƒœ ì´ˆê¸°í™”
            if (assistant.isListening) {
                assistant.stopListening();
            }
            
            console.log('assistant ê°ì²´ ìƒì„±ë¨:', assistant);
            
            try {
                // initialize ë©”ì„œë“œê°€ ì—†ìœ¼ë¯€ë¡œ ìƒì„± ì‹œì ì—ì„œ ì´ë¯¸ ì´ˆê¸°í™”ë¨
                log('âœ… ì´ˆê¸°í™” ì™„ë£Œ - ìŒì„± ì¸ì‹ ìˆ˜ë™ ì‹œì‘ ê°€ëŠ¥');
                updateStatus('hyperclovaStatus', 'ì¤€ë¹„', 'status-active');
                updateStatus('aiEngineStatus', 'HyperCLOVA X', 'status-active');
                updateStatus('speechStatus', 'ëŒ€ê¸°', 'status-inactive');
                
                // ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
                document.getElementById('startBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                assistant.onCommandReceived = (command) => {
                    log(`ğŸ¯ ëª…ë ¹ ì¸ì‹: "${command.transcript}" â†’ ${command.intent} (${(command.confidence * 100).toFixed(1)}%)`);
                    
                    // ì„±ëŠ¥ ì¸¡ì •
                    const engine = command.source === 'hyperclova' ? 'hyperclova' : 'openai';
                    if (command.responseTime) {
                        testResults[engine].tests++;
                        testResults[engine].totalTime += command.responseTime;
                        if (command.confidence > 0.8) testResults[engine].successes++;
                        
                        updateTestResults();
                    }
                };
                
            } catch (error) {
                log(`âŒ ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`);
                console.error('ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                updateStatus('hyperclovaStatus', 'ì˜¤ë¥˜', 'status-inactive');
                assistant = null; // ì‹¤íŒ¨ ì‹œ nullë¡œ ì„¤ì •
            }
            
            console.log('initializeAssistant ì™„ë£Œ, assistant:', assistant);
        }
        
        function updateTestResults() {
            // HyperCLOVA X ê²°ê³¼
            const hcx = testResults.hyperclova;
            document.getElementById('hyperclovaTests').textContent = hcx.tests;
            document.getElementById('hyperclovaAccuracy').textContent = hcx.tests > 0 ? `${(hcx.successes/hcx.tests*100).toFixed(1)}%` : '-';
            document.getElementById('hyperclovaSpeed').textContent = hcx.tests > 0 ? `${(hcx.totalTime/hcx.tests).toFixed(0)}ms` : '-';
            
            // OpenAI ê²°ê³¼
            const oai = testResults.openai;
            document.getElementById('openaiTests').textContent = oai.tests;
            document.getElementById('openaiAccuracy').textContent = oai.tests > 0 ? `${(oai.successes/oai.tests*100).toFixed(1)}%` : '-';
            document.getElementById('openaiSpeed').textContent = oai.tests > 0 ? `${(oai.totalTime/oai.tests).toFixed(0)}ms` : '-';
        }
        
        async function startListening() {
            console.log('startListening í˜¸ì¶œë¨, assistant ìƒíƒœ:', assistant);
            if (!assistant) {
                alert('ë¨¼ì € ì–´ì‹œìŠ¤í„´íŠ¸ë¥¼ ì´ˆê¸°í™”í•´ì£¼ì„¸ìš”');
                log('âŒ assistant ê°ì²´ê°€ nullì…ë‹ˆë‹¤');
                return;
            }
            
            try {
                await assistant.startListening();
                updateStatus('speechStatus', 'ì¸ì‹ ì¤‘', 'status-active');
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
                log('ğŸ¤ ìŒì„± ì¸ì‹ ì‹œì‘ë¨');
            } catch (error) {
                log(`âŒ ìŒì„± ì¸ì‹ ì‹œì‘ ì‹¤íŒ¨: ${error.message}`);
                updateStatus('speechStatus', 'ì˜¤ë¥˜', 'status-inactive');
            }
        }
        
        function stopListening() {
            if (assistant) {
                assistant.stopListening();
                updateStatus('speechStatus', 'ì¤‘ì§€', 'status-inactive');
                document.getElementById('startBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
                log('â¹ï¸ ìŒì„± ì¸ì‹ ì¤‘ì§€ë¨');
                
                // ì¸ì‹ ì¤‘ì§€ ì‹œ ì„±ëŠ¥ í†µê³„ í‘œì‹œ
                displayPerformanceStats();
            }
        }
        
        function displayPerformanceStats() {
            log('ğŸ“Š ì„±ëŠ¥ í†µê³„ í‘œì‹œ:');
            
            // HyperCLOVA X í†µê³„
            const hcx = testResults.hyperclova;
            if (hcx.tests > 0) {
                const avgSpeed = (hcx.totalTime / hcx.tests).toFixed(0);
                const accuracy = ((hcx.successes / hcx.tests) * 100).toFixed(1);
                log(`  ğŸŸ¦ HyperCLOVA X: ${hcx.tests}íšŒ í…ŒìŠ¤íŠ¸, í‰ê·  ${avgSpeed}ms, ì •í™•ë„ ${accuracy}%`);
            } else {
                log(`  ğŸŸ¦ HyperCLOVA X: í…ŒìŠ¤íŠ¸ ë°ì´í„° ì—†ìŒ`);
            }
            
            // OpenAI í†µê³„
            const oai = testResults.openai;
            if (oai.tests > 0) {
                const avgSpeed = (oai.totalTime / oai.tests).toFixed(0);
                const accuracy = ((oai.successes / oai.tests) * 100).toFixed(1);
                log(`  ğŸŸ¨ OpenAI: ${oai.tests}íšŒ í…ŒìŠ¤íŠ¸, í‰ê·  ${avgSpeed}ms, ì •í™•ë„ ${accuracy}%`);
            } else {
                log(`  ğŸŸ¨ OpenAI: í…ŒìŠ¤íŠ¸ ë°ì´í„° ì—†ìŒ`);
            }
            
            // ìŠ¹ë¶€ ê²°ê³¼
            if (hcx.tests > 0 && oai.tests > 0) {
                const hcxAvgSpeed = hcx.totalTime / hcx.tests;
                const oaiAvgSpeed = oai.totalTime / oai.tests;
                const hcxAccuracy = (hcx.successes / hcx.tests) * 100;
                const oaiAccuracy = (oai.successes / oai.tests) * 100;
                
                const speedWinner = hcxAvgSpeed < oaiAvgSpeed ? 'HyperCLOVA X' : 'OpenAI';
                const accuracyWinner = hcxAccuracy > oaiAccuracy ? 'HyperCLOVA X' : 'OpenAI';
                
                log(`  ğŸƒ ì†ë„ ìš°ìŠ¹: ${speedWinner} (${Math.abs(hcxAvgSpeed - oaiAvgSpeed).toFixed(0)}ms ì°¨ì´)`);
                log(`  ğŸ¯ ì •í™•ë„ ìš°ìŠ¹: ${accuracyWinner} (${Math.abs(hcxAccuracy - oaiAccuracy).toFixed(1)}% ì°¨ì´)`);
            }
        }
        
        async function simulateVoice(command) {
            if (!assistant) {
                alert('ë¨¼ì € ì–´ì‹œìŠ¤í„´íŠ¸ë¥¼ ì´ˆê¸°í™”í•´ì£¼ì„¸ìš”');
                return;
            }
            
            log(`ğŸ­ ìŒì„± ì‹œë®¬ë ˆì´ì…˜: "${command}"`);
            updateStatus('speechStatus', 'ë¶„ì„ ì¤‘', 'status-processing');
            
            const startTime = performance.now();
            
            try {
                // ì§ì ‘ ì˜ë„ ë¶„ì„ í˜¸ì¶œ
                const result = assistant.config.hyperclovaApiKey ? 
                    await assistant.callHyperCLOVAX(command) :
                    await assistant.callOpenAI(command);
                
                const responseTime = performance.now() - startTime;
                result.responseTime = responseTime;
                
                updateStatus('responseTime', `${responseTime.toFixed(0)}ms`, 'status-active');
                log(`âœ… AI ë¶„ì„ ì™„ë£Œ: ${result.intent} (ì‹ ë¢°ë„: ${(result.confidence * 100).toFixed(1)}%) - ${result.source}`);
                
                // ì‹¤ì œ ëª…ë ¹ ì‹¤í–‰
                await assistant.executeIntentAction(result);
                
            } catch (error) {
                log(`âŒ ëª…ë ¹ ì²˜ë¦¬ ì‹¤íŒ¨: ${error.message}`);
            }
            
            updateStatus('speechStatus', assistant.isListening ? 'ì¸ì‹ ì¤‘' : 'ì¤‘ì§€', 
                        assistant.isListening ? 'status-active' : 'status-inactive');
        }
        
        async function testHyperCLOVA() {
            if (!assistant) {
                alert('ë¨¼ì € ì–´ì‹œìŠ¤í„´íŠ¸ë¥¼ ì´ˆê¸°í™”í•´ì£¼ì„¸ìš”');
                return;
            }
            
            log('ğŸ§ª HyperCLOVA X ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            const testCommands = [
                "ì•ˆë…•í•˜ì„¸ìš”",
                "ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”", 
                "ê²€ìƒ‰í•˜ê³  ì‹¶ì–´ìš”",
                "ê·¸ê²Œ ë§ë‚˜ìš”",
                "ë§¥ë‚  ì°¾ì•„ì¤˜"
            ];
            
            for (const cmd of testCommands) {
                try {
                    const startTime = performance.now();
                    const result = await assistant.callHyperCLOVAX(cmd);
                    const responseTime = performance.now() - startTime;
                    
                    log(`âœ… "${cmd}" â†’ ${result.intent} (${(result.confidence*100).toFixed(1)}%, ${responseTime.toFixed(0)}ms)`);
                    
                    testResults.hyperclova.tests++;
                    testResults.hyperclova.totalTime += responseTime;
                    if (result.confidence > 0.8) testResults.hyperclova.successes++;
                    
                } catch (error) {
                    log(`âŒ "${cmd}" ì‹¤íŒ¨: ${error.message}`);
                }
                
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            updateTestResults();
            log('ğŸ‰ HyperCLOVA X í…ŒìŠ¤íŠ¸ ì™„ë£Œ!');
        }
        
        // ì‹¤ì œ ìŒì„±ì¸ì‹ ê¸°ë°˜ ì„±ëŠ¥ ë¹„êµ í•¨ìˆ˜
        async function compareEngines() {
            if (!assistant) {
                alert('ë¨¼ì € ì–´ì‹œìŠ¤í„´íŠ¸ë¥¼ ì´ˆê¸°í™”í•´ì£¼ì„¸ìš”');
                return;
            }
            
            log('ğŸ†š ì‹¤ì œ ìŒì„±ì¸ì‹ ê¸°ë°˜ ì„±ëŠ¥ ë¹„êµ ì‹œì‘...');
            log('ğŸ¤ ìŒì„± ëª…ë ¹ì„ ë§í•´ì£¼ì„¸ìš”. ë‘ ëª¨ë¸ì´ ë™ì‹œì— ì²˜ë¦¬í•©ë‹ˆë‹¤.');
            
            // ë””ë²„ê¹… ì •ë³´
            log(`ğŸ“‹ API í‚¤ ìƒíƒœ: HyperCLOVA X=${!!assistant.config.hyperclovaApiKey}, OpenAI=${!!assistant.config.openaiApiKey}`);
            
            // ìŒì„± ì¸ì‹ì´ ì¤‘ì§€ë˜ì–´ ìˆë‹¤ë©´ ì‹œì‘
            if (!assistant.isListening) {
                log('ğŸ”„ ìŒì„± ì¸ì‹ì´ ì¤‘ì§€ë˜ì–´ ìˆì–´ ì‹œì‘í•©ë‹ˆë‹¤...');
                await startListening();
            } else {
                log('âœ… ìŒì„± ì¸ì‹ì´ ì´ë¯¸ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤');
            }
            
            // ì‹¤ì œ ìŒì„± ì¸ì‹ì„ ìœ„í•´ ì‚¬ìš©ìì—ê²Œ ë§í•˜ë„ë¡ ì•ˆë‚´
            updateStatus('speechStatus', 'ë¹„êµ ëŒ€ê¸° ì¤‘', 'status-processing');
            assistant.speak('ìŒì„± ëª…ë ¹ì„ ë§í•´ì£¼ì„¸ìš”. ë‘ AI ëª¨ë¸ì´ ë™ì‹œì— ë¶„ì„í•©ë‹ˆë‹¤.');
            
            // ì›ë˜ì˜ processCommandë¥¼ ë°±ì—…í•˜ê³  ìƒˆë¡œìš´ í•¨ìˆ˜ë¡œ êµì²´
            const originalProcessCommand = assistant.processCommand.bind(assistant);
            log('ğŸ’¾ ì›ë˜ processCommand ë°±ì—… ì™„ë£Œ');
            
            // Arrow functionìœ¼ë¡œ this ì»¨í…ìŠ¤íŠ¸ ìœ ì§€
            assistant.processCommand = async (transcript) => {
                log(`ğŸ¯ ìŒì„± ì¸ì‹ë¨: "${transcript}"`);
                log('ğŸ“Š ë‘ ëª¨ë¸ ë™ì‹œ ë¶„ì„ ì¤‘...');
                
                const results = { hyperclova: null, openai: null };
                const startTime = performance.now();
                
                try {
                    // ë‘ ëª¨ë¸ì„ ë³‘ë ¬ë¡œ ì‹¤í–‰
                    const promises = [];
                    
                    if (assistant.config.hyperclovaApiKey) {
                        log('ğŸš€ HyperCLOVA X ë¶„ì„ ì‹œì‘...');
                        promises.push(
                            assistant.callHyperCLOVAX(transcript).then(result => {
                                result.responseTime = performance.now() - startTime;
                                results.hyperclova = result;
                                log(`ğŸŸ¦ HyperCLOVA X: ${result.intent} (${(result.confidence*100).toFixed(1)}%, ${result.responseTime.toFixed(0)}ms)`);
                                
                                // ì„±ëŠ¥ í†µê³„ ìˆ˜ì§‘
                                testResults.hyperclova.tests++;
                                testResults.hyperclova.totalTime += result.responseTime;
                                if (result.confidence > 0.8) testResults.hyperclova.successes++;
                                
                            }).catch(error => {
                                log(`âŒ HyperCLOVA X ì‹¤íŒ¨: ${error.message}`);
                                console.error('HyperCLOVA X ì˜¤ë¥˜:', error);
                                results.hyperclova = { error: error.message };
                            })
                        );
                    } else {
                        log('âš ï¸ HyperCLOVA X API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤');
                    }
                    
                    if (assistant.config.openaiApiKey) {
                        log('ğŸš€ OpenAI ë¶„ì„ ì‹œì‘...');
                        promises.push(
                            assistant.callOpenAI(transcript).then(result => {
                                result.responseTime = performance.now() - startTime;
                                results.openai = result;
                                log(`ğŸŸ¨ OpenAI: ${result.intent} (${(result.confidence*100).toFixed(1)}%, ${result.responseTime.toFixed(0)}ms)`);
                                
                                // ì„±ëŠ¥ í†µê³„ ìˆ˜ì§‘
                                testResults.openai.tests++;
                                testResults.openai.totalTime += result.responseTime;
                                if (result.confidence > 0.8) testResults.openai.successes++;
                                
                            }).catch(error => {
                                log(`âŒ OpenAI ì‹¤íŒ¨: ${error.message}`);
                                console.error('OpenAI ì˜¤ë¥˜:', error);
                                results.openai = { error: error.message };
                            })
                        );
                    } else {
                        log('âš ï¸ OpenAI API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤');
                    }
                    
                    // ë‘ ëª¨ë¸ì˜ ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦¼
                    log(`â³ ${promises.length}ê°œ ëª¨ë¸ ë¶„ì„ ëŒ€ê¸° ì¤‘...`);
                    await Promise.all(promises);
                    log('âœ… ëª¨ë“  ëª¨ë¸ ë¶„ì„ ì™„ë£Œ');
                    
                    // ì‹¤ì‹œê°„ í†µê³„ ì—…ë°ì´íŠ¸
                    updateTestResults();
                    
                    // ê²°ê³¼ ë¹„êµ ë° ì¶œë ¥
                    displayComparisonResults(transcript, results);
                    
                    // ë” ì¢‹ì€ ê²°ê³¼ë¡œ ì‹¤ì œ ëª…ë ¹ ì‹¤í–‰
                    const betterResult = selectBetterResult(results);
                    if (betterResult && betterResult.confidence > 0.6) {
                        log(`ğŸ¯ ìµœì¢… ì„ íƒ: ${betterResult.source} (ì‹¤í–‰)`);
                        await assistant.executeIntentAction(betterResult);
                    }
                    
                } catch (error) {
                    log(`âŒ ì„±ëŠ¥ ë¹„êµ ì‹¤íŒ¨: ${error.message}`);
                    console.error('ì„±ëŠ¥ ë¹„êµ ì˜¤ë¥˜:', error);
                }
                
                // ë‹¤ìŒ ë¹„êµë¥¼ ìœ„í•´ ëŒ€ê¸°
                setTimeout(() => {
                    if (assistant.isListening) {
                        assistant.speak('ë‹¤ìŒ ëª…ë ¹ì„ ë§í•´ì£¼ì„¸ìš”');
                    }
                }, 2000);
            };
            
            log('ğŸ”§ ì„±ëŠ¥ ë¹„êµ ëª¨ë“œ í™œì„±í™” ì™„ë£Œ - ìŒì„± ëª…ë ¹ ëŒ€ê¸° ì¤‘');
            
            // 5ë¶„ í›„ ì›ë˜ í•¨ìˆ˜ë¡œ ë³µì›
            setTimeout(() => {
                assistant.processCommand = originalProcessCommand;
                log('ğŸ”„ ì„±ëŠ¥ ë¹„êµ ëª¨ë“œ ì¢…ë£Œ - ì¼ë°˜ ëª¨ë“œë¡œ ë³µì›');
                updateStatus('speechStatus', assistant.isListening ? 'ì¸ì‹ ì¤‘' : 'ì¤‘ì§€', 
                           assistant.isListening ? 'status-active' : 'status-inactive');
            }, 300000);
            
        }
        
        // ë¹„êµ ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
        function displayComparisonResults(transcript, results) {
            log(`ğŸ“Š "${transcript}" ë¶„ì„ ê²°ê³¼:`);
            
            if (results.hyperclova && !results.hyperclova.error) {
                log(`  ğŸŸ¦ HyperCLOVA X: ${results.hyperclova.intent} (${(results.hyperclova.confidence*100).toFixed(1)}%, ${results.hyperclova.responseTime.toFixed(0)}ms)`);
            }
            
            if (results.openai && !results.openai.error) {
                log(`  ğŸŸ¨ OpenAI: ${results.openai.intent} (${(results.openai.confidence*100).toFixed(1)}%, ${results.openai.responseTime.toFixed(0)}ms)`);
            }
            
            // ìŠ¹ë¶€ ê²°ê³¼ í‘œì‹œ
            const winner = selectBetterResult(results);
            if (winner) {
                const winnerName = winner.source === 'hyperclova-x-v3' ? 'ğŸ† HyperCLOVA X' : 
                                 winner.source === 'openai' ? 'ğŸ† OpenAI' : 'ğŸ¤ ë™ë“±';
                log(`  ${winnerName} ìŠ¹ë¦¬ (ì‹ ë¢°ë„ ${(winner.confidence*100).toFixed(1)}%)`);
            }
        }
        
        // ë” ë‚˜ì€ ê²°ê³¼ ì„ íƒ í•¨ìˆ˜
        function selectBetterResult(results) {
            const hcx = results.hyperclova && !results.hyperclova.error ? results.hyperclova : null;
            const openai = results.openai && !results.openai.error ? results.openai : null;
            
            if (!hcx && !openai) return null;
            if (!hcx) return openai;
            if (!openai) return hcx;
            
            // ì‹ ë¢°ë„ ê¸°ë°˜ ì„ íƒ (í•œêµ­ì–´ íŠ¹í™”ëŠ” HyperCLOVA Xì— ê°€ì )
            const hcxScore = hcx.confidence + (hcx.source === 'hyperclova-x-v3' ? 0.1 : 0);
            const openaiScore = openai.confidence;
            
            return hcxScore >= openaiScore ? hcx : openai;
        }
        
    </script>
</body>
</html>